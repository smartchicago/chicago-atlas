
- if show_header
  %h3
    = dataset.name
    %a.btn.btn-info.pull-right{ :href => "/place/#{@geography.slug}/#{dataset.name.parameterize.underscore.to_sym}" } Details

.span4
  %p 
    = dataset.description

.span7
  - chart_stats = fetch_chart_data(dataset.id, @geography.id)
  - chicago_avg_stats = fetch_chart_data(dataset.id, 100) # ID for Chicago
  - chart_id = "chart_#{dataset.id}_#{dataset.name.parameterize.underscore.to_sym}"

  .chart{:id => chart_id}
  - content_for :javascripts do
    
    :javascript
      $(function () {

        var seriesData = [{
          color: colorHash[(#{dataset.id} % 7)],
          type: 'line',
          data: #{chart_stats[:data]},
          name: "#{geography.name}"
        },{
          name: 'Confidence interval',
          type: 'errorbar',
          data: #{chart_stats[:error_bars]},
          tooltip: {
            pointFormat: '(Confidence interval: {point.low}-{point.high} mm)<br/>'
          }
        }, {
          color: "#666",
          type: 'line',
          data: #{chicago_avg_stats[:data]},
          name: "Chicago"
        }
        ];


        ChartHelper.create("#{chart_id}", "line", "", seriesData, Date.UTC(#{chart_stats[:start_year]}, 1, 1), "year", "#{dataset.stat_type}");
      });

.clearfix
